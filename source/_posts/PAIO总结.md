---
title: PAIO总结
date: 2024-03-14 10:52:43
tags:
typora-root-url: ..
categories:
    - 论文阅读
---

# PAIO: General, Portable I/O Optimizations With Minor Application Modifications

论文原地址https://www.usenix.org/conference/fast22/presentation/macedo

## 摘要

PAIO是一个框架，为不同的应用程序实现**可移植**的I/O策略和**优化**，开发人员只需要对**原始的代码库**进行**少量修改**。主要思路是：如果我们能够在请求流经I/O堆栈的不同层时拦截和区分请求，我们就可以在不显著更改层本身的情况下执行复杂的存储策略。PAIO用到了软件定义存储的思想，构建了数据平面stages(mediate和优化跨层的I/O请求)和控制平面(根据不同的存储策略对各个步骤进行协调和微调)。用两个用例展示了PAIO的性能和适用性。

**第一种**方法将基于行业标准lsm的键值存储的第99百分位延迟提高了4倍。**第二个**是确保共享存储环境下动态的每个应用程序带宽保证

## Introduction

以数据为中心的系统已经逐渐成为I/O堆栈的一部分。通常使用存储优化( I/O scheduling, differentiation, and caching)来提高这种系统的性能。但这些优化方式和系统实现紧密耦合，并且由于缺乏全局上下文而可能相互干扰。例如，区分前台和后台I/O以减少尾部延迟等优化方法被广泛应用，然而现在在KVS中实现的方式需要对系统有深刻的理解，并且可移植性很低。类似地，部署在共享基础设施上的应用程序的优化可能由于彼此不了解而发生冲突。

> 基于基础架构的存储优化存在互相干扰、可移植性差、应用程序冲突的问题

本文认为存在一种更好的方式来实现存储优化。PAIO是一种用户级框架，通过采用软件定义存储(SDS)社区的思想，可以构建可移植且普遍适用的存储优化。**关键思想**是通过拦截和处理应用程序执行的I/O，在应用程序之外实现优化，作为数据平步骤。然后，这些优化由逻辑上集中的管理器(控制平面)控制，该管理器具有防止它们之间相互干扰所必需的全局上下文。PAIO不需要对内核进行修改，同时可以达到修改内核存储优化方法的效果。

> 关键思想是在数据平面优化每个应用程序的IO，然后在控制平面获取全局状态。

PAIO的实现面临了很多的挑战。为了在应用程序外部执行复杂的I/O优化，PAIO需要在I/O堆栈中向下传播上下文，从高级api向下传播到以较小粒度执行I/O的较低层。它通过结合上下文传播的思想来实现这一点，使应用程序级的信息能够传播到数据平面步骤，只需进行少量的代码更改，而无需修改现有的api。

> 挑战1是如何把应用程序的信息传播到数据平面

PAIO要求设计新的抽象，允许在用户空间I/O层之间区分和协调I/O请求，同时增强了存储优化的可移植性和易部署性。PAIO主要有四个抽象。`enforcement object`是一个可编程组件，它将单个用户定义的策略(例如速率限制或调度)应用于传入的I/O请求。PAIO使用`context objects`来描述和区分请求，并通过`channels`连接I/O请求、`enforcement object`和`context objects`。为了确保独立存储优化之间的协调(例如，公平性，优先级)，具有全局可见性的控制平面通过使用`rules`对`enforcement object`进行微调

```
用户空间I/O层是什么东西，具体有哪些
```

<img src="/images/PAIO总结/image-20240315163546597.png" alt="image-20240315163546597" style="zoom:67%;" />

> PAIO主要有四个抽象：enforcement object、context objects、channels、rules

使用上述的新特性和抽象，系统设计人员可以开发定制SDS数据平面步骤。为了演示这一点，我们用下面两个用例验证PAIO。**第一**，在RocksDB中添加了一个步骤，然后演示如何通过编排前台和后台任务来防止延迟峰值。结果表明，与基线RocksDB相比，在不同的工作负载和测试场景(例如，不同的存储设备，有和没有I/O带宽限制)下，启用PAIO的RocksDB将第99百分位延迟提高了4，并且与SILK相比实现了相似的尾延迟性能。这就证明了I/O优化可以更简单、更易移植的实现。**第二**，我们将PAIO应用于TensorFlow，并展示了如何在ABCI超级计算机的真实共享存储场景下实现动态的每个应用程序带宽保证。结果显示使用了PAIO的TensorFlow实例带宽目标都被满足了。

```
Software-Defined Storage(SDS)思想主要有什么
```

> PAIO在两个场景下进行了验证

本文贡献如下：

- 一个用户级框架，用于构建可编程和动态适应的数据平面步骤
- 实现了两个目标：(1)减少LSM KVS中的延迟峰值;(2)在共享存储设置下实现每个应用的带宽保证
- 实验结果验证了该方法在综合和真实场景下的性能和适用性

## Motivation and Challenges

当前系统内I/O优化的问题

### 紧耦合的优化

**问题描述**：大多数I/O优化都是单一用途的，因为它们紧密集成在每个系统的核心中。实现这些优化需要对内核有了解，并熟悉内部代码。这就限制了它们的可维护性和跨系统的可移植性。例如，为了减少RocksDB的尾部延迟峰值，SILK提出了一个I/O调度器来控制前台和后台任务之间的干扰。在RocksDB中实现SILK的优化需要修改很多核心模块的代码。并且SILK也不容易实现在别的KVS(LevelDB,pebble)中。

**解决方案**：解耦优化。I/O优化应该从系统的内部逻辑中分离出来，并转移到专用层，从而在不同的场景中变得普遍适用和可移植。

**挑战**：刚性接口。解耦优化是有代价的，因为没有办法使用系统特定优化中存在的粒度和内部应用程序知识。具体来说，传统的I/O堆栈模型需要通过难以扩展的严格接口进行通信，从而丢弃了可用于对不同粒度级别的请求进行分类和区分的信息。例如，图1是一个KVS和POSIX兼容的系统





























